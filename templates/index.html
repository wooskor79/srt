<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Language Reactor SRT ë³€í™˜ê¸°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f7f7f9; }
        .log-box { background-color: #0d1117; color: #e6edf3; font-family: 'Consolas', monospace; }
        .log-box::-webkit-scrollbar { width: 8px; }
        .log-box::-webkit-scrollbar-thumb { background: #30363d; border-radius: 4px; }
    </style>
</head>
<body class="p-4 sm:p-8 min-h-screen flex items-center justify-center">

    <div class="w-full max-w-2xl bg-white shadow-xl rounded-2xl p-6 sm:p-10 border border-gray-100">
        <h1 class="text-3xl font-bold text-gray-900 mb-2 text-center">Language Reactor SRT ë³€í™˜ê¸°</h1>
        <p class="text-center text-gray-500 mb-8">ì˜µì…˜ì„ ì„ íƒí•˜ê³  XLSX íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”.</p>
        
        <form id="upload-form" class="space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">1. í”Œë«í¼ ì„ íƒ</label>
                    <div class="flex space-x-4">
                        <label class="inline-flex items-center"><input type="radio" name="platform" value="youtube" checked class="form-radio text-indigo-600"><span class="ml-2 text-gray-700">ìœ íŠœë¸Œ</span></label>
                        <label class="inline-flex items-center"><input type="radio" name="platform" value="netflix" class="form-radio text-indigo-600"><span class="ml-2 text-gray-700">ë„·í”Œë¦­ìŠ¤</span></label>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">2. ìë§‰ ìœ í˜•</label>
                    <div class="flex flex-wrap gap-4">
                        <label class="inline-flex items-center"><input type="radio" name="subtitle_type" value="original" class="form-radio text-indigo-600"><span class="ml-2 text-gray-700">ì›ë¬¸</span></label>
                        <label class="inline-flex items-center"><input type="radio" name="subtitle_type" value="translation" class="form-radio text-indigo-600"><span class="ml-2 text-gray-700">ë²ˆì—­(í•œê¸€ë§Œ)</span></label>
                        <label class="inline-flex items-center"><input type="radio" name="subtitle_type" value="dual" checked class="form-radio text-indigo-600"><span class="ml-2 text-gray-700">ì›ë¬¸+ë²ˆì—­</span></label>
                    </div>
                </div>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">3. ì €ì¥ ë°©ì‹</label>
                <div class="flex space-x-4">
                    <label class="inline-flex items-center"><input type="radio" name="save_method" value="nas" class="form-radio text-indigo-600"><span class="ml-2 text-gray-700">NAS ì €ì¥</span></label>
                    <label class="inline-flex items-center"><input type="radio" name="save_method" value="download" checked class="form-radio text-indigo-600"><span class="ml-2 text-gray-700">ë‚´ PCë¡œ ë‹¤ìš´ë¡œë“œ</span></label>
                </div>
            </div>

            <input type="file" id="files" name="files" multiple accept=".xlsx" class="block w-full text-sm border rounded-lg p-3">
            <button type="submit" class="w-full py-3 bg-indigo-600 text-white font-semibold rounded-xl shadow-lg hover:bg-indigo-700 transition transform hover:scale-[1.01]">ë³€í™˜ ì‹œì‘</button>
        </form>
        
        <div class="mt-8 pt-6 border-t border-gray-200">
            <h2 class="text-sm font-semibold text-gray-600 mb-2">ë¡œê·¸ / ìƒíƒœ</h2>
            <div id="log-container" class="log-box w-full h-48 p-4 rounded-lg overflow-y-auto text-xs leading-relaxed">
                > ëŒ€ê¸° ì¤‘...
            </div>
        </div>
    </div>

    <script>
        const form = document.getElementById('upload-form');
        const logBox = document.getElementById('log-container');

        form.onsubmit = async (e) => {
            e.preventDefault();
            logBox.innerHTML = "> ì‘ì—…ì„ ì‹œì‘í•©ë‹ˆë‹¤...<br>";
            const formData = new FormData(form);

            try {
                const response = await fetch('/', { method: 'POST', body: formData });
                if (!response.ok) throw new Error("ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜");
                
                const data = await response.json();
                logBox.innerHTML = ""; 

                data.messages.forEach(msg => {
                    const isSuccess = msg[0] === 'Success';
                    logBox.innerHTML += `<span class="${isSuccess ? 'text-green-400' : 'text-red-400'}">${isSuccess ? 'ğŸŸ¢' : 'ğŸ”´'} [${msg[0]}] ${msg[1]}</span><br>`;
                });

                if (data.download) {
                    // Blobì„ ì´ìš©í•´ ë¸Œë¼ìš°ì € ê¸°ë³¸ ë‹¤ìš´ë¡œë“œ ìœ„ì¹˜ë¡œ ì¦‰ì‹œ ì „ì†¡
                    const blob = new Blob([data.download.content], { type: 'text/plain;charset=utf-8' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.style.display = 'none';
                    a.href = url;
                    a.download = data.download.filename;
                    document.body.appendChild(a);
                    a.click();
                    setTimeout(() => {
                        document.body.removeChild(a);
                        window.URL.revokeObjectURL(url);
                    }, 100);
                    logBox.innerHTML += `<span class="text-indigo-400">ğŸ”¹ ë‚´ PCë¡œ ì¦‰ì‹œ ë‹¤ìš´ë¡œë“œê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.</span><br>`;
                }
            } catch (err) {
                logBox.innerHTML += `<span class="text-red-400">ğŸ”´ [Error] ì„œë²„ í†µì‹  ì‹¤íŒ¨ ë˜ëŠ” ë°ì´í„° ì²˜ë¦¬ ì˜¤ë¥˜.</span><br>`;
                console.error(err);
            }
            logBox.scrollTop = logBox.scrollHeight;
        };
    </script>
</body>
</html>